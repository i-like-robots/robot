#!/usr/bin/env node

var path = require('path');
var cli = require('../lib/cli');
var optimist = require('optimist');

var usage = [
  '',
  '  Usage: robot <path> [command] [options]',
  '',
  '  Commands:',
  '',
  '    scratch <path> - Copies a project skeleton',
  '    compile <path> [options] - Renders the project and saves to disk',
  '',
  '  Compile options:',
  '',
  '    -s, --source   Source directory',
  '    -o, --output   Output directory'
].join('\n');

var cmd = optimist.usage(usage).alias('s', 'source').alias('o', 'output').alias('h', 'help');
var opts = cmd.argv;

if (opts.help) {
  optimist.showHelp();
  process.exit(1);
}

var target = path.normalize(process.cwd() + '/' + (opts._.length === 2 ? opts._.pop() : ''));
var command = opts._.length ? opts._.pop() : 'No command';

if (cli.hasOwnProperty(command)) {
  cli[command](target, opts);
}
else {
  console.log('Command "' + command + '" not found');
}