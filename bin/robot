#!/usr/bin/env node

var path = require('path');
var cli = require('../lib/cli');
var optimist = require('optimist');

var usage = [
  '',
  '  Usage: robot [command] [options]',
  '',
  '  Commands:',
  '',
  '    scratch <location> - Copy skeleton project',
  '    compile <location> [options] - Render project',
  '',
  '  Compile options:',
  '',
  '    -s, --source   Source directory',
  '    -o, --output   Output directory',
  '    -h, --help     Show help',
  '    -v, --verbose  Verbose output'
].join('\n');

var cmd = optimist.usage(usage).alias('s', 'source').alias('o', 'output').alias('h', 'help').alias('v', 'verbose');
var opts = cmd.argv;

if (opts.help) {
  optimist.showHelp();
  process.exit(1);
}

var target = path.normalize(process.cwd() + '/' + (opts._.length === 2 ? opts._.pop() : ''));
var command = opts._.length ? opts._.pop() : 'No command';

if (cli.hasOwnProperty(command)) {
  cli[command](target, opts);
}
else {
  console.log('Command "' + command + '" not found');
}